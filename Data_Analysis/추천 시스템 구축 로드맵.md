# 추천 시스템 구축 로드맵

> 중고거래 제품의 카테고리(여성신발, 축구공 등)를 고객에서 추천해주는 시스템

## 1. 데이터 생성

### 1-1. 카테고리 데이터 생성 (완료)

* 카테고리 선정
    * 11개 대분류 / 111개 중분류 / 423개 소분류
* 카테고리를 DB에 입력

### 1-2. 데이터 직접 다 입력하기

1. 중고거래 물품 데이터 생성
    * 각 카테고리별로 2~3개의 중고 물품 생성
    * 직접 하긴 좀 힘드니까 이미지 서버에 사진 올리고, 미리 링크 받아 놓기
2. 유저 데이터 생성
    * 유저는 한 300명정도...? (원하는 만큼 생성 가능)
3. 중고거래 판매 데이터 생성
    * 위에서 생성한 1000여개의 데이터에 판매 정보 생성
4. 중고거래 물품 조회 데이터 생성
    * 1000개 이상 필요합니당..

### 1-3. Modeling용 Dummy Data 생성

> 사실 필요한 건 user - category - 조회 횟수가 들어있는 sparse matrix....

* DB에 중고거래 물품 1000개와 그에 해당하는 판매, 조회 데이터를 넣는건 비효율적

* 카드사 데이터를 활용하여 14개 유형 약 42개정도?의 가상 userId에 대해

    카테고리 - 조회횟수 데이터를 입력하면 modeling에 사용 가능

    * 예시

        ```bash
        9001번 User => 20대 여성 패션/레저 에 많은 관심
        (9001, 1, 27) # 여성 상의
        (9001, 2, 14) # 여성 하의
        (9001, 3, 7) # 여성 잠옷
        (9001, 4, 3) # 여성 언더웨어
        (9001, 31, 12) # 여성 구두
        (9001, 91, 10) # 여성용 모자
        (9001, 111, 7) # 반지
        (9001, 112, 8) # 귀걸이
        (9001, 991, 14) # 자전거
        (9001, 992, 12) # 자전거 부품
        (9001, 993, 11) # 자전거 안전용품
        (9001, 994, 32) # 기타 자전거 용품
        (9001, 1041, 7) # 스케이트 보드
        
        9002번 User => 70대 남성 출산/육아 및 도서/음반/문구에 큰 관심
        (9002, 823, 27) # 유아 가구
        (9002, 832, 17) # 유아동 의류
        (9002, 1071, 37) # 학습/교육 도서
        (9002, 1075, 32) # 문학/과학/경영 도서
        ```

    * 다음에 할 일

        1. 각각의 성별 / 나이대에 대해서 페르소나 설정
        2. 각각의 페르소나에 대해 카테고리/조회 횟수 설정





## 2. 기초 Model 생성

> 앞서 만든 더미 데이터를 활용하여 추천 Model 생성 (기본 / IBCF / MF)

### 2-1.  기본 추천 모델  (신규 및 거래 내역 거의 없는 User)

* User 정보를 토대로 해당 User와 같은 그룹(연령, 성별)에 있는 유저의 카테고리별 평균 조회수 계산

    가장 높은 예상 조회수를 가지는 카테고리의 제품들을 추천하기

### 2-2. 협업 필터링 (어느정도 Data가 확보된 User)

* IBCF
* MF
* Hybird
* 셋 다 계산을 통해서 적절한 변수값 찾아야 됨

* 언제 2-1에서 2-2로 전환할 것인가는 어떻게 판단하죠?
    1. 최소 3개 카테고리의 제품 조회
    2. 카테고리 / 조회수를 늘려가면서 2개 Model로 Error 측정해보기
    3. 어느정도 수준 내로 들어오면 교체 타이밍으로 선정
        * 아마 N개 카테고리 총 M개 이상 제품을 조회했을 경우 라는 조건







## 기초: 어떤 값을 예측할 것인가?

* 특정 사용자가 어떤 카테고리의 제품을 몇번 조회/구매 할 것인가?를 예측해서

    높은 값을 가지는 카테고리 추천 예정



## Error 측정 방식

### 1. 조건....

1. scale-dependent measure X

    * 100번 추천했는데 99번 조회한 경우와
    * 10번 추천했는데 9번 조회한 경우는 차이가 존재해야 됨

2. outlier robuts

    * 사용자는 원하는 카테고리의 물품만 조회할 수도 있음
    * 각 항목간의 values가 균일하지 않고, 다수의 outlier 포함 가능

3. 데이터 특성을 잘 반영해야 됨

    1. 실제값 / 예측값이 0 혹은 0에 가까울 확률이 높은 데이터 셋

        실제 특정 카테고리 제품을 조회한 값(실제값)이 0 혹은 0에 가까운 값이 다수 존재

    2. 과대평가에 더 큰 패널티 필요
        1. 30번 볼 것이다 < 실제 40번 봄 : 과소 평가
        2. 30번 볼 것이다 > 실제 20번 봄 : 과대 평가 / 안 볼 광고에 더 많이 노출됨 / 패널티 필요

### 2. 후보군 (RMSE / MAPE / sMAPE / RMSLE)

* RMSE

    * 문제점

        1. scale-dependent measure
            1. 100번 추천했는데 99번 조회한 경우
            2. 10번 추천했는데 9번 조회한 경우

            * 둘 다 동일한 Error (1)로 계산됨

        2. Outlier가 다수 존재할 경우....

* MAPE

    * 비율에 따라 계산되기 때문에 조금 더 효율적인것같지만

        실제값이 0인 경우 대처하기 어려움

        + 실제로 2번 본 경우
    + 0번 / 1번이라고 예측(추천) : 100% / 50% 오차
        
            + 3번 / 4번 / 5번이라고 예측(추천) : 50% / 100% / 150% 오차
        
        + 예측이 더 큰경우 제한없는 패널티 가능
    
* sMAPE

    * 가능성은 있어보이지만... 0이 많은 데이터 특성 상 예측값도 0에 가까울 가능성이 높음

        0에 가까운 데이터가 많은 경우 대처하기 어려움..

    * 과소추천에 더 큰 패널티를 줌... (반대)

* RMSLE

    * 여러 장점이 있어서 채택하기 괜찮아보임
    * 대신 과소추천에 큰 패널티를 주는 것은 문제
        * 30번 볼 것이다 < 실제 40번 봄 : 현재 더 큰 패널티...
        * 30번 볼 것이다 > 실제 20번 봄 : 안 볼 광고에 더 많이 노출됨
        * 보지 않을 제품을 여러번 추천할 경우 (과대평가인 경우) 패널티가 더 커야될 것

* NRMSE 찾아보기 (정규화된 RMSE)



## 추천시스템 성능 평가 지표

* 클릭률(CTR) 사용 예정
    * 조회/구매 하지 않은 제품만 추천리스트에 포함될 예정
    * 추천 페이지 방문 횟수와 추천 탭의 아이템 클릭 횟수로 비교



